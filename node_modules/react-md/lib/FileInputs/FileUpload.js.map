{"version":3,"sources":["../../src/js/FileInputs/FileUpload.js"],"names":["FileUpload","state","abort","file","fileName","Object","keys","name","reader","querySelector","value","setState","_uploadFile","props","onAbort","onError","onLoad","onLoadStart","onLoadEnd","onProgress","readAs","type","fr","FileReader","onerror","e","target","error","onabort","onloadstart","onloadend","onload","result","onprogress","lengthComputable","loaded","total","match","readAsDataURL","readAsText","readAsArrayBuffer","_handleUpload","fileList","onChange","maxSize","onSizeError","files","Array","isArray","errorFiles","filter","size","length","nextState","forEach","fileReader","propTypes","style","object","className","string","labelStyle","labelClassName","primary","bool","secondary","flat","accept","multiple","label","node","iconChildren","iconClassName","number","propName","component","others","func","isRequired","oneOfType","oneOf","allowDuplicates"],"mappings":"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","file":"FileUpload.js","sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { findDOMNode } from 'react-dom';\nimport FileInput from './FileInput';\n\nimport omit from '../utils/omit';\n\n/**\n * The `FileUpload` component is used to upload files locally This is a wrapper of the `FileInput` component\n * with some additional functionality so any props that are undocumented on `FileUpload` but are present\n * on `FileInput` are correctly provided. If you want to upload files to a server, use\n * [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData)\n * by attaching the `File`.\n *\n * Quick example:\n *\n * ```js\n * function upload(file) {\n *   fetch('/api/images', {\n *     method: 'POST',\n *     body: new FormData().append('file', file),\n *   });\n * }\n * ```\n *\n * An upload can be aborted by calling the `abort(file || fileName)` function. If\n * the file or fileName are omitted, it will *attempt* to abort the current\n * file that is uploading. Unreliable for multi-select.\n *\n * ```js\n * <FileUpload ref=\"upload\" />\n * <Button raised onClick={() => this.refs.upload.abort()} label=\"Abort! Abort!\" />\n * ```\n */\nexport default class FileUpload extends PureComponent {\n  static propTypes = {\n    /**\n     * An optional style to apply.\n     */\n    style: PropTypes.object,\n\n    /**\n     * An optional className to apply.\n     */\n    className: PropTypes.string,\n\n    /**\n     * An optional style to apply to the label.\n     */\n    labelStyle: PropTypes.object,\n\n    /**\n     * An optional className to apply to the label.\n     */\n    labelClassName: PropTypes.string,\n\n    /**\n     * Boolean if the `FileInput` should be styled with the primary color.\n     */\n    primary: PropTypes.bool,\n\n    /**\n     * Boolean if the `FileInput` should be styled with the secondary color.\n     */\n    secondary: PropTypes.bool,\n\n    /**\n     * Boolean if the `FileInput` should be styled as a flat button instead of a\n     * raised button.\n     */\n    flat: PropTypes.bool,\n\n    /**\n     * This should be a comma separated list of Media Types that the `FileInput` can\n     * accept. If this prop is left blank, any file will be accepted.\n     *\n     * The values can either be:\n     * - A file extension\n     * - audio/*\n     * - video/*\n     * - image/*\n     * - any valid [IANA Media Type](http://www.iana.org/assignments/media-types/media-types.xhtml)\n     */\n    accept: PropTypes.string,\n\n    /**\n     * Boolean if multiple files will be accepted.\n     */\n    multiple: PropTypes.bool,\n\n    /**\n     * A label to display on the `FileInput`.\n     */\n    label: PropTypes.node,\n\n    /**\n     * The icon children to use for the upload icon.\n     */\n    iconChildren: PropTypes.node,\n\n    /**\n     * The icon className to use for the upload icon.\n     */\n    iconClassName: PropTypes.string,\n\n    /**\n     * An optional max size for the file. If the file is greater than\n     * this limit, the file will not be uploaded.\n     */\n    maxSize: PropTypes.number,\n\n    /**\n     * A required function to call when the `maxSize` prop is set. It will\n     * be given a list of files that were too big.\n     */\n    onSizeError: (props, propName, component, ...others) => {\n      if (typeof props.maxSize === 'number') {\n        return PropTypes.func.isRequired(props, propName, component, ...others);\n      }\n\n      return null;\n    },\n\n    /**\n     * You can force the `FileReader` to read the file as a specific type\n     * if you do not trust the *amazing* regex I have for choosing the correct\n     * one.\n     *\n     * ```js\n     * if(type.match(/image|video|audio/)) {\n     *   fr.readAsDataURL(file);\n     * } else if(type.match(/application|model|multipart/)) {\n     *   fr.readAsArrayBuffer(file);\n     * } else {\n     *   fr.readAsText(file);\n     * }\n     * ```\n     *\n     * > `.yml` and `.js` both are considered `application`, so it definitely fails there.\n     *\n     * If this prop is a function, you will be given the file's type, the file object, and\n     * the file reader. You will then need to call `fileReader.readAsYOUR_CORRECT_TYPE(file)`.\n     */\n    readAs: PropTypes.oneOfType([\n      PropTypes.oneOf(['DataURL', 'ArrayBuffer', 'Text']),\n      PropTypes.func,\n    ]),\n\n    /**\n     * An optional function to call when the `FileUpload` aborts. The current\n     * file and the abort event are given. This might not be the most useful\n     * function to use since you will need to manually call abort yourself anyways.\n     */\n    onAbort: PropTypes.func,\n\n    /**\n     * An optional function to call when the `FileUpload` errors. The current\n     * file, the error, and the error event are given.\n     *\n     * ```js\n     * onError(file, event.target.error, event);\n     * ```\n     */\n    onError: PropTypes.func,\n\n    /**\n     * An optional function to call when the `FileUpload` loads. The current\n     * file, the load result, and the load event are given.\n     *\n     * ```js\n     * onLoad(file, event.target.result, event);\n     * ```\n     *\n     * The load result will either be:\n     * - a data URL\n     * - a plain text string\n     * - an array buffer\n     *\n     * depending on what type the file is.\n     */\n    onLoad: PropTypes.func,\n\n    /**\n     * An optional function to call when the `FileUpload` starts loading. The current\n     * file and the load start event are given.\n     */\n    onLoadStart: PropTypes.func,\n\n    /**\n     * An optional function to call when the `FileUpload` finishes loading. The\n     * current file and the load end event are given.\n     */\n    onLoadEnd: PropTypes.func,\n\n    /**\n     * An optional function to call when the `FileUpload` progress. The current\n     * file, upload progress, and the progress event are given. The progress\n     * will be a number between 0 and 100 that has not been rounded.\n     *\n     * ```js\n     * onProgress(file, progress, event);\n     * ```\n     */\n    onProgress: PropTypes.func,\n\n    /**\n     * Boolean if the same file is allowed to be uploaded multiple times. This will basically make the\n     * `value` of the file input always blank.\n     */\n    allowDuplicates: PropTypes.bool,\n\n    /**\n     * An optional function to call when a file selects or unselects a file.\n     * This will be called before any local uploading occurs.\n     *\n     * ```js\n     * onChange(file(s) || null, event);\n     * ```\n     */\n    onChange: PropTypes.func,\n\n    /**\n     * An optional value to apply to the `FileInput`. This is usually not needed and the\n     * `allowDuplicates` is what you are probably looking for instead.\n     *\n     * @see {@link #allowDuplicates}\n     */\n    value: PropTypes.string,\n  };\n\n  state = {};\n\n  /**\n   * Attempts to abort the upload of a file. This function takes an optional `file` or `fileName`\n   * as it's parameter. If the parameter is omitted, it attempts to abort the first file that was\n   * added. If the `onAbort` function was given, it will be called as well.\n   *\n   * @param {Object|string} file - The file or the file name to use to find the\n   *     correct `FileReader`.\n   */\n  abort = (file) => {\n    let fileName = file;\n    if (!file) {\n      // Attempt to remove first file added...\n      fileName = Object.keys(this.state)[0];\n    } else if (typeof file.name === 'string') {\n      fileName = file.name;\n    }\n\n    const reader = this.state[fileName];\n    if (reader) {\n      reader.abort();\n      findDOMNode(this).querySelector('.md-file-input').value = '';\n\n      this.setState(omit(this.state, [fileName]));\n    }\n  };\n\n  _uploadFile = (file) => {\n    const {\n      onAbort,\n      onError,\n      onLoad,\n      onLoadStart,\n      onLoadEnd,\n      onProgress,\n      readAs,\n    } = this.props;\n\n    const { name, type } = file;\n\n    const fr = new FileReader();\n    if (onError) {\n      fr.onerror = e => {\n        onError(file, e.target.error, e);\n      };\n    }\n\n    if (onAbort) {\n      fr.onabort = e => {\n        onAbort(file, e);\n      };\n    }\n\n    if (onLoadStart) {\n      fr.onloadstart = e => {\n        onLoadStart(file, e);\n      };\n    }\n\n    if (onLoadEnd) {\n      fr.onloadend = e => {\n        onLoadEnd(file, e);\n      };\n    }\n\n    fr.onload = e => {\n      if (onLoad) {\n        onLoad(file, e.target.result, e);\n      }\n\n      this.setState(omit(this.state, [name]));\n    };\n\n    if (onProgress) {\n      fr.onprogress = e => {\n        if (e.lengthComputable) {\n          onProgress(file, (e.loaded / e.total) * 100, e);\n        }\n      };\n    }\n\n    if (readAs) {\n      if (typeof readAs === 'function') {\n        readAs(type, file, fr);\n      } else {\n        fr[`readAs${readAs}`](file);\n      }\n    } else if (type.match(/image|video|audio|application\\/pdf/) || name.match(/\\.mkv$/)) {\n      fr.readAsDataURL(file);\n    } else if (type.match(/application\\/json/)) {\n      fr.readAsText(file);\n    } else if (type.match(/application|model|multipart/) || name.match(/(w|e)ar$/)) {\n      fr.readAsArrayBuffer(file);\n    } else {\n      fr.readAsText(file);\n    }\n\n    return fr;\n  };\n\n  _handleUpload = (fileList, e) => {\n    if (this.props.onChange) {\n      this.props.onChange(fileList, e);\n    }\n\n    if (!fileList) { return; }\n    const { maxSize, onSizeError } = this.props;\n    let files = Array.isArray(fileList) ? fileList : [fileList];\n\n    let errorFiles = [];\n    if (maxSize) {\n      errorFiles = files.filter(file => file.size > maxSize);\n      files = files.filter(file => file.size <= maxSize);\n    }\n\n    if (errorFiles.length) {\n      onSizeError(errorFiles);\n    }\n\n    if (!files.length) {\n      return;\n    }\n\n    const nextState = {};\n    files.forEach(file => {\n      const fileReader = this._uploadFile(file);\n      nextState[file.name] = fileReader;\n    });\n\n    this.setState(nextState);\n  };\n\n  render() {\n    const {\n      /* eslint-disable no-unused-vars */\n      maxSize,\n      readAs,\n      onLoad,\n      onLoadStart,\n      onLoadEnd,\n      onProgress,\n      onAbort,\n      onError,\n      onSizeError,\n      /* eslint-enable no-unused-vars */\n      ...props\n    } = this.props;\n\n    return <FileInput {...props} onChange={this._handleUpload} />;\n  }\n}\n"]}